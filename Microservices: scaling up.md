Задача 1: Кластеризация
Предложите решение для обеспечения развёртывания, запуска и управления приложениями. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

поддержка контейнеров;
обеспечивать обнаружение сервисов и маршрутизацию запросов;
обеспечивать возможность горизонтального масштабирования;
обеспечивать возможность автоматического масштабирования;
обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.
Обоснуйте свой выбор.

Решение:

Для обеспечения развёртывания, запуска и управления приложениями в микросервисной архитектуре с учётом всех перечисленных требований оптимальным решением является использование Kubernetes (K8s) в сочетании с системой управления секретами, такой как HashiCorp Vault или встроенные механизмы Kubernetes для работы с секретами. Kubernetes предоставляет все необходимые инструменты для управления контейнеризированными приложениями, обеспечивая гибкость, масштабируемость и безопасность.

Основные компоненты решения:
Kubernetes:

Поддержка контейнеров: Kubernetes — это оркестратор контейнеров, который поддерживает работу с Docker и другими контейнерными средами (например, containerd). Он управляет жизненным циклом контейнеров, обеспечивая их надёжное развёртывание, запуск и мониторинг.
Обнаружение сервисов и маршрутизация запросов: Kubernetes имеет встроенный механизм для Service Discovery (обнаружение сервисов). Каждый сервис в кластере может быть автоматически обнаружен и использован другими сервисами через DNS. Для маршрутизации внешних запросов используется Ingress или LoadBalancer. Эти компоненты управляют входящими запросами и направляют их к нужным сервисам.
Горизонтальное масштабирование: Kubernetes позволяет автоматически масштабировать количество реплик подов на основе загруженности системы (например, CPU, RAM). Для этого используется механизм Horizontal Pod Autoscaler (HPA), который настраивается в зависимости от метрик и автоматически добавляет или удаляет реплики.
Автоматическое масштабирование: Помимо HPA, Kubernetes поддерживает Cluster Autoscaler, который автоматически добавляет новые узлы (серверы) в кластер или удаляет их, если нагрузка изменяется. Это позволяет эффективно управлять ресурсами кластера и автоматически увеличивать или уменьшать количество ресурсов в зависимости от потребностей приложения.
Разделение ресурсов: Kubernetes позволяет чётко разделять ресурсы и доступы. С помощью Namespaces можно изолировать ресурсы приложений внутри кластера, а через Network Policies управлять доступом между компонентами внутри кластера и внешними ресурсами. Это обеспечивает высокий уровень безопасности и управления доступами.
Конфигурирование с помощью переменных среды: Kubernetes поддерживает работу с ConfigMaps и Secrets для передачи конфигураций и чувствительных данных (таких как пароли, ключи шифрования, токены). ConfigMaps позволяют управлять неконфиденциальными данными, а Secrets обеспечивают безопасное хранение и передачу чувствительной информации. Secrets шифруются при хранении и могут быть переданы в поды через переменные среды.
HashiCorp Vault (или Kubernetes Secrets):

Безопасное хранение секретов: Vault обеспечивает централизованное управление секретами, шифрование данных, управление доступами и автоматическую ротацию ключей. Это даёт возможность безопасно хранить и использовать секретные данные в приложениях, что особенно важно для микросервисной архитектуры.
Интеграция с Kubernetes: Vault можно интегрировать с Kubernetes, чтобы автоматизировать подачу секретов в приложения через переменные среды или файлы. Это обеспечивает безопасное хранение данных, таких как пароли, ключи доступа или сертификаты.
Альтернатива: Если использование стороннего сервиса вроде Vault не требуется, Kubernetes имеет встроенный механизм для безопасного хранения секретов, который может быть использован для небольших кластеров. Kubernetes Secrets могут быть шифрованы на уровне хранилища и также предоставляют безопасный способ передачи чувствительных данных в поды.
Traefik или NGINX Ingress Controller:

Маршрутизация и балансировка нагрузки: Для маршрутизации запросов от внешних пользователей к сервисам внутри кластера можно использовать Ingress Controller (например, Traefik или NGINX). Эти решения обеспечивают динамическую маршрутизацию, автоматическую генерацию SSL-сертификатов и балансировку нагрузки на уровне HTTP/HTTPS.
SSL-терминация: Ingress-контроллеры могут выполнять терминацию HTTPS на уровне внешних запросов, обеспечивая безопасность данных при передаче.
Пример работы системы:
Развёртывание и управление контейнерами: Kubernetes управляет контейнеризованными приложениями с помощью объектов типа Deployment, которые определяют, сколько экземпляров (реплик) приложения должно быть запущено, как они должны быть распределены и как Kubernetes должен обновлять контейнеры при релизах.

Обнаружение сервисов и маршрутизация: Внутри кластера микросервисы могут обращаться друг к другу через DNS имена, используя механизмы Service Discovery. Внешние пользователи подключаются к приложениям через Ingress, который управляет маршрутизацией и SSL-терминацией.

Горизонтальное масштабирование: Kubernetes автоматически масштабирует количество подов в зависимости от загруженности. Например, если нагрузка на один из сервисов возрастает, Horizontal Pod Autoscaler создаст больше реплик этого сервиса для обработки запросов.

Автоматическое масштабирование инфраструктуры: Если кластер начинает испытывать нехватку ресурсов (например, CPU или RAM на хостах), Cluster Autoscaler может автоматически добавить новые узлы в кластер.

Управление конфигурацией и секретами: Конфигурационные параметры для приложений передаются через ConfigMaps, а чувствительные данные, такие как пароли и ключи, через Secrets или HashiCorp Vault, обеспечивая безопасность и удобство управления.

Преимущества решения:
Масштабируемость: Kubernetes легко масштабируется как в рамках одного сервиса (горизонтальное масштабирование подов), так и на уровне всего кластера (автоматическое добавление узлов).
Гибкость и надёжность: Поддержка множества инструментов для работы с контейнерами, расширяемость через операторы и интеграции с внешними сервисами делают Kubernetes универсальным решением для управления микросервисами.
Обнаружение и маршрутизация сервисов: Встроенные механизмы Service Discovery и поддержка Ingress обеспечивают надёжное взаимодействие между сервисами и маршрутизацию внешних запросов.
Безопасность: Секреты хранятся в зашифрованном виде, а использование Vault или встроенных секретов Kubernetes позволяет безопасно управлять доступами к критическим данным.
Автоматическое масштабирование: Механизмы HPA и Cluster Autoscaler обеспечивают динамическое распределение нагрузки и эффективное использование ресурсов.
Управление конфигурацией: Kubernetes предоставляет удобные и безопасные механизмы для конфигурации приложений через переменные среды и файлы.
Вывод:
Использование Kubernetes в качестве оркестратора контейнеров и системы управления кластером — это надёжное и гибкое решение, которое полностью отвечает требованиям микросервисной архитектуры. В сочетании с HashiCorp Vault или встроенными секретами Kubernetes,

это решение обеспечивает безопасность и удобное управление конфигурацией и секретами. Kubernetes позволяет эффективно развёртывать, масштабировать и поддерживать микросервисы, обеспечивая надёжное обнаружение сервисов, автоматическое масштабирование, безопасное хранение чувствительных данных и маршрутизацию запросов.
